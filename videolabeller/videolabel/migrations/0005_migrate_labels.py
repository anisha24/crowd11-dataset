# Generated by Django 4.1 on 2024-05-20 09:36

from django.db import migrations

def migrate_labels(apps, schema_editor):
    Label = apps.get_model('videolabel', 'Label')
    Video = apps.get_model('videolabel', 'Video')
    VideoLabel = apps.get_model('videolabel', 'VideoLabel')

    label_names = set(Video.objects.values_list('label', flat=True))
    label_map = {}
    for name in label_names:
        label, created = Label.objects.get_or_create(name=name)
        label_map[name] = label

    for video in Video.objects.all():
        video.new_label = label_map[video.label]
        video.save()

    for video_label in VideoLabel.objects.all():
        video_label.new_label = label_map[video_label.label]
        video_label.save()

class Migration(migrations.Migration):

    dependencies = [
        ('videolabel', '0004_label_video_new_label_videolabel_new_label'),
    ]

    operations = [
        migrations.RunPython(migrate_labels)
    ]
